# アジャイル開発
Agile（素早い）

アジャイル開発のプロセスは、大きなシステムを一気に作るのではなく、**小さく作って、すぐ見せて、作り直す**というサイクルの繰り返し。

**ウォーターフォール**との最大の違いは、「後戻り」を前提としていること。

**アジャイル宣言:** 「計画の遵守よりも変化への対応を」といった4つの価値観。

## 標準的なプロセス

### 1. リリース計画 (Release Planning)

まず、作りたい機能の優先順位リスト（**プロダクトバックログ**）を作る。一度に全部作るのではなく、「今回はここまで作る」という範囲を決める。

### 2. イテレーション／スプリント (Iteration / Sprint)

Iteration（反復、繰り返し）

通常**1週間〜4週間**という短い期間（XPではイテレーション、スクラムではスプリントと呼ぶ）で、以下の作業を完結させる。

- **計画（要件定義）:** この期間でやる機能を決める。
- **開発:** 設計・コーディング・テストをセットで行う。
- **レビュー:** 実際に動くものを顧客に見せてフィードバックをもらう。

### 3. デイリースタンドアップ (Daily Stand-up)

毎日、短時間のミーティング（デイリースクラムなど）を行い、「昨日やったこと」「今日やること」「困っていること」を共有して、軌道修正を繰り返す。

### 4. ふりかえり (Retrospective)

イテレーションの最後に、チームの動きを改善するための話し合い。
次のサイクルをより良くするためのステップ。


## スクラム (Scrum)

ラグビーのスクラムのようにチームが一丸となって目標（ゴール）を目指す様子が語源で、複雑な問題に対して「検査・適応」を繰り返しながら、製品の価値を最大化することを目指します。 

スクラムは**3-5-3**と呼ばれる構成要素で整理されます。 

### 1. 3つの役割（ロール）

チームは通常10人以下の少人数で構成され、それぞれ明確な責任を持ちます。 

#### **プロダクトオーナー (PO):** 「何をいつ作るか」を決定する責任者。
  - プロダクトの**目標の明確化と共有**
  - プロダクトバックログの**作成・管理**
  - **優先順位**の明確化
  - 開発段階の監視
  - 顧客の要求の把握・ニーズを予測し反映
#### **スクラムマスター (SM):** 調整・司会・進行・コーチ役。
  - スプリント計画の進行
  - デイリースクラムの開催
  - スプリントレビューの開催
  - チーム内外の問題解決
  - プロダクトバックログの**改善**
#### **開発者:** 実際に動作する成果物を作成する実務者。 
 - プログラムなどの成果物（インクリメント）の作成

### 2. 5つのイベント

開発は**スプリント**と呼ばれる一定期間（通常1〜4週間）のサイクルを繰り返します。 

1. **スプリント:** 開発の基本単位となる期間そのもの。
2. **スプリントプランニング:** （初日）期間内の目標と計画を立てる会議。
   →**開発者**がスプリントバックログを作成
3. **デイリースクラム:** （毎日）15分程度行い、進捗と障害を共有する場。
4. **スプリントレビュー:** （最終日）成果物をステークホルダーにデモし、フィードバックを得る場。
5. **レトロスペクティブ:** （最終日）チームの働き方を振り返り、次への改善策を決める場。 
   →**プロダクトオーナー**がインクリメントを承認


### 3. 3つの作成物（アーティファクト）

- **プロダクトバックログ:** 実現したい機能や改善点の優先順位付きリスト。
- **スプリントバックログ:** そのスプリントで完了させると決めた具体的タスク。
- **インクリメント:** 各スプリントの終了時に完成した、利用可能な製品の断片。 

---

## エクストリーム・プログラミング (XP)

XPは、開発の**プラクティス**（実践的な手法や習慣）に焦点を当てている点が特徴。
アジャイルの原則を「極端な（エクストリーム）」までに徹底することで、高品質なソフトウェアを迅速に開発することを目指す。

|特徴|エクストリーム・プログラミング (XP)|スクラム (Scrum)|
|---|---|---|
|**焦点**|具体的な**開発手法**（ペアプロ、TDDなど）|プロジェクト管理の**フレームワーク**（役割、イベント）|
|**期間**|1〜2週間の短いイテレーションが多い|1〜4週間のスプリント|
|**役割**|顧客の常駐を重視|プロダクトオーナー、スクラムマスターなどの役割が明確|

XPは技術的な側面が非常に強く、「どうやって高品質なコードを書くか」に重点を置く。
スクラムが「どうやってプロジェクトを管理・推進するか」に重点を置いているのと対照的。

### 5つの価値観

1. **コミュニケーション (Communication)**  
    問題の多くは「誰かが何かを知らなかった」ことで起きます。対話を重視し、知識をチーム全体で共有します。
2. **シンプル (Simplicity)**  
    「明日必要になるかもしれない」ではなく「今日必要な最小限」を追求します。複雑さを排除し、変化に対応しやすくします。（YAGNIの原則）
3. **フィードバック (Feedback)**  
    システム（テスト）、顧客（レビュー）、チーム（振り返り）から絶えず情報を得て、即座に軌道修正します。
4. **勇気 (Courage)**  
    「動いているコードを直す（リファクタリング）」「失敗を認める」「無理なスケジュールにNOと言う」といった、正しい選択のための勇気を持ちます。
5. **リスペクト（尊重 / Respect） 【第２版で追加】**
    他のメンバーの貢献を認め、お互いの尊厳を重んじます。**人間を大切にしないプロジェクトは成功しない**という強い意志が反映されました。

### 24のプラクティス

1. プライマリ・プラクティス（13項目）

導入初期から実践すべき、XPの土台となる活動。

- **座って一緒に働く:** オープンなスペースで顔を合わせて作業する。
- **チーム全体:** 必要なスキルを持つ全員をチームに含める。
- **情報満載のワークスペース:** 状況が一目でわかる掲示物などを作る。
- **活力ある仕事:** 集中力を保てる健康的な状態で働く。
- **ペアプログラミング:** 2人1組でコードを書く。
- **ストーリー:** 顧客が望む価値を短い単位で記述する。
- **週単位のサイクル:** 1週間ごとに計画を立て、動くソフトを作る。
- **四半期単位のサイクル:** 3ヶ月ごとに大きな方向性を確認する。
- **ゆとり:** 予定を詰め込みすぎず、学習や改善の時間を確保する。
- **10分ビルド:** 全テストを含むビルドを10分以内に完了させる。
- **継続的インテグレーション:** 変更をすぐに全体に統合する。
- **テストファースト・プログラミング:** 実装の前にテストを書く。
- **インクリメンタルな設計:** 毎日少しずつ設計を改善し続ける（リファクタリング）

2. コーラリー・プラクティス（11項目）

プライマリが定着した後に挑戦する、より高度で「極端な」実践。

- **本物の顧客関与:** 顧客をチームの一部として深く関わらせる。
- **インクリメンタルなデプロイ:** 新機能を少しずつ本番環境へ出す。
- **チームによる継続的な改善:** 常にプロセスを最適化し続ける。
- **共有リポジトリ:** 誰でもどこでも変更できる状態にする（集団所有）。
- **コードとテスト:** ドキュメントより「動くコードとテスト」を重視する。
- **単一のコードベース:** 枝分かれさせず、常に一つの最新版を保つ。
- **日々のデプロイ:** 開発したものをその日のうちに本番へ（継続的デリバリー）。
- **交渉によるスコープ契約:** 期間や予算ではなく「範囲」を柔軟にする。
- **支払い機能ごと:** 機能が完成するたびに価値（支払い）を認識する。
- **全体像:** システム全体のアーキテクチャを全員が理解する。
- **分析クラス:** 専門家と共通言語でモデルを議論する。

### **CI/CD（継続的インテグレーション／継続的デリバリー）**

XP第2版の文脈では：

- **Continuous Integration（継続的インテグレーション）**: そのままXPの主要プラクティスである「継続的インテグレーション」に該当。
- **Continuous Delivery（継続的デリバリー/デプロイ）**: 応用プラクティスの「日々のデプロイ」に該当。

### 日本での問題点

1. ペアプログラミングの「日本的」な壁

日本の現場では「1人の仕事を2人でやるのは非効率（コスト2倍）」と上司に反対されたり、心理的な抵抗感が強い。

- **課題:** 「監視されているようで疲れる」「実力差があると教育の時間になってしまう」
- **XP的な解決策:**
    - **「生産性」の定義を変える:** 1人で書いたバグを後で直すコスト（手戻り）と、2人で最初から高品質なコードを書くコストを比較し、ペアプロによる品質向上を定量的に示す。
    - **ドライバとナビゲータ:** 役割をこまめに交代し、対等なコミュニケーションを維持。

2. リファクタリング：いつ、どうやるか

「動いているコードを触るな」という古い格言が根強い現場では、リファクタリングの時間を確保するのが困難です。

- **課題:** 「納期優先で後回しにされ、技術負債が溜まる」「壊れるのが怖くて直せない」
- **XP的な解決策:**
    - **「リファクタリングの時間」を作らない:** 独立した工程にするのではなく、テスト駆動開発 (TDD)のサイクル（レッド・グリーン・リファクタ）に組み込み、日常の「掃除」として行う。
    - **自動テストが「勇気」を支える:** XPにおいてリファクタリングと自動テストはセット。テストがあるからこそ、「壊してもすぐわかる」という安心感が生まれ、コードを綺麗にする「勇気」を持てる。

3. 日本の現場での**リスペクト**の重要性

第2版で追加された「リスペクト」は、特に日本の「和」を重んじる文化と親和性が高い一方で、**忖度**とは異なる。

- **リスペクト:** 相手のミスを責めるのではなく、失敗を仕組みで解決しようとする姿勢（例：バグが出たのはテストを書かなかった仕組みのせいだ、と考える）。


### リファクタリング

1. YAGNI（ヤグニ）原則

**"You aren't gonna need it"**（そんなの必要ないって）の略。

- **考え方:** 「将来、拡張が必要になるかもしれない」という予測だけで複雑な設計を作り込まず、**「今、必要な機能」だけを、最もシンプルな設計で実装する**という原則。
- **リファクタリングとの関係:** 予期せぬ未来のためのコードは、後から邪魔（負債）になることが多々ある。XPでは「必要になった瞬間に、リファクタリングによって設計を進化させればいい」と考える。これにより、常にコードを軽量に保つ。

---

2. コードの不吉な臭い (Bad Smells in Code)

リファクタリングを「いつ、どこで」行うべきかを見極めるためのサイン。

- **長すぎるメソッド:** 1つの関数が何でもやりすぎている状態。→ **メソッドの抽出**（小分けにする）が必要。
- **巨大なクラス:** 1つのクラスに責任が集中しすぎている。→ **クラスの抽出**で役割を分担。
- **重複したコード:** 似たような処理があちこちにある。→ 1箇所にまとめて共通化。
- **機能の不適切な親密性:** 他のクラスの詳細を覗きすぎている。→ データの持ち主（オブジェクト）に処理を任せる。

---

3. リファクタリングを成功させる手順

XPでは、以下の**3つの帽子**を被り分けるように意識。

1. **グリーンの帽子（実装）:** テストをパスさせることだけを考え、泥臭くても動くコードを書く。
2. **リファクタリングの帽子:** **機能を変えずに**コードを綺麗にする。この間、新しい機能は一切追加しない。
3. **テストの帽子:** 最後にテストを流し、壊れていないことを確認する。

この「帽子」を頻繁に（数分〜数十分単位で）被り直すのが、XPの理想的なリズム。

### **テスト駆動開発 (TDD)**

実装の前にテストを書くことで、設計を洗練させながら高品質なコードを迅速に作成するための開発プラクティス。 

基本的なリズム：レッド・グリーン・リファクタ 

TDDは、以下の3つのステップを短期間（数分〜数十分）で繰り返す「リズム」で進める。 

1. **レッド（失敗）**: 求める機能を定義するテストコードを先に書き、意図的に失敗させる。
2. **グリーン（成功）**: テストを通過させるための最小限のコードを書く。
3. **リファクタリング**: コードの動作を変えずに、重複を排除し設計をきれいに整える。 

XPにおける役割とメリット

- **設計の道具**: テストは単なる検証ではなく、「このコードはどう動くべきか」という設計意図を整理する手段として機能。
- **安全網の構築**: 自動テストが整備されるため、将来の仕様変更やリファクタリングを安心して行える。
- **他のプラクティスとの連動**: ペアプログラミングと組み合わせることでバグの混入を極限まで防ぎ、継続的インテグレーションを支える基盤となる。 

