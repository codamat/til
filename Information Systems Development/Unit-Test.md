# Unit-Test（単体テスト）

プログラムの最小構成単位（関数、メソッド、クラスなど）が、設計通りに正しく動作するかを**モジュール単位で**個別に検証するテスト。
開発の初期段階で実装者自身が実施し、バグの早期発見・修正により後工程の手戻りを防ぐ役割。 

**単体テストの詳細**

- **対象**: 関数、メソッド、クラス、モジュールなど、コードの最小機能単位。
- **実施者**: 主にコーディングを行った開発者自身。
- **タイミング**: コーディング直後の早期段階。
- **目的**: 最小単位でのバグ発見、仕様通りの動作確認、コードの品質担保。 

**メリット**

- **バグの早期発見**: 初期段階で見つけるため、修正コストが低い。
- **問題の特定が容易**: どの部品に不具合があるかすぐにわかる。
- **変更への安心感**: 既存機能の破壊（デグレード）を防げる。 

**テストの手法**

- **ホワイトボックステスト**: コードの内部構造（分岐やループ）を意識して検証する。
- **ブラックボックステスト**: 内部構造を意識せず、入力に対して正しい結果が返ってくるかを検証する。
- **境界値テスト**: 境界値（例：0や最大値）でのエラーをチェックする。
- **自動化**: JUnitなどのツールを用いて自動化することが現代的な手法では推奨される。 

結合テストは部品同士を組み合わせた連携をチェックするのに対し、単体テストは各部品の「独立した」動作に焦点を当てる。


テストの目的・特性による分類

「正しく動くか」以外の側面をチェックする手法です。

- **回帰テスト（リグレッションテスト）**
    - 修正や機能追加をした際に、「今まで動いていた部分に影響が出ていないか」を再確認します。
- **非機能テスト**
    - **性能テスト:** 大量のデータやアクセスに耐えられるか。
    - **セキュリティテスト:** 脆弱性がないか。
    - **ユーザビリティテスト:** 使い勝手が良いか。
- **モンキーテスト**
    - 手順を決めず、ランダムに操作して予期せぬエラーが起きないか確認します。

---

テスト手法のまとめ表

|手法名|概要|よく使われる場面|
|---|---|---|
|**静的テスト**|コードを実行せずにレビューや解析でミスを見つける|開発初期・コードレビュー|
|**動的テスト**|実際に動かして挙動を確認する|一般的なテスト全般|
|**アドホックテスト**|計画を立てず、勘や経験に基づき自由にテストする|予期せぬバグの発見|

## ブラックボックステスト

プログラムの内部構造（ソースコード）は一切見ず、外部から見た**入力と出力の結果だけ**に着目して、仕様通りに動くかを検証する手法。 

ユーザーがシステムを操作するのと同じ視点で行うため、システムテストや受け入れテストなどの後半工程で重宝されます。 

### 1. 主なテスト設計技法

すべてのパターンをテストするのは現実的ではないため、以下の代表的な技法を使って不具合を見つける。

1. **同値分割（同値分析）法**
    - **考え方:** 「同じ結果（エラーや正常終了など）になるはずの入力値」をグループ化し、その中から**代表的な値を1つ**選んでテスト。
    - **例:** 1〜100点を受け付けるフォームなら、「正常（50点）」、「小さすぎる（-10点）」、「大きすぎる（150点）」の3パターンで検証。
2. **境界値分析**
    - **考え方:** バグが発生しやすい**値の境界**を重点的にテスト。
    - **例:** 「100以上で割引」という仕様なら、境界となる「99（割引なし）」と「100（割引あり）」をピンポイントで確認。
3. **状態遷移テスト**
    - **考え方:** 「未決済 → 決済完了 → 発送済み」のように、特定の操作によってシステムの状態が正しく変わるかを検証。 

### 2. メリットとデメリット

|特徴|内容|
|---|---|
|**メリット**|実装の詳細を知らなくてもテストできるため、第三者（テスト専門家やユーザー）が客観的に評価できます。|
|**デメリット**|内部のロジックを無視するため、特定の条件下でのみ通る「隠れたバグ（デッドコードなど）」を見逃す可能性があります。|

## ホワイトボックステスト
プログラム（モジュール）の**内部構造（ソースコード）を熟知した状態**で行うテスト手法。 

ブラックボックスが「外からの動き」を見るのに対し、ホワイトボックスは「中身のロジック（分岐やループ）」が意図通りに組み立てられているかを検証。主に開発者自身が**単体テスト**の工程で実施。 

### 1. 網羅率（カバレッジ）

ホワイトボックステストでは、コードをどれだけ漏れなく実行できたかを示す**カバレッジ**（網羅率）という指標を重視。主な基準は以下。 

- **命令網羅 (C0: Statement Coverage):** すべての**命令文だけ**を少なくとも1回実行（**分岐は考慮しない**）。
- **分岐（判定条件）網羅 (C1: Branch Coverage):** すべての**分岐点**（if文の真・偽など）を少なくとも1回実行。（**命令網羅も同時に満足される**）
- **条件網羅 (C2):** すべての条件を通るようにテストする。
- **複数条件網羅 (MCC):** **すべての条件の組み合わせ**をテストする。
- **パス網羅:** プログラムの開始から終了までの考えうる**すべての経路**をテスト（最も厳密）。 

#### 条件網羅（C2）と複数条件網羅（MCC）の違い

例えば、`if (A かつ B)` という処理がある場合。

- **条件網羅 (C2: Condition Coverage):**
    - Aが「真・偽」の両方を通る、Bが「真・偽」の両方を通る。
    - つまり各条件の真偽をバラバラに確認する。
    - 例：(A=真, B=真) と (A=偽, B=偽) の **2パターン** でOK。
- **複数条件網羅 （MCC: Multiple Condition Coverage）:**
    - AとBのすべての組み合わせをテストする。
    - (真, 真)、(真, 偽)、(偽, 真)、(偽, 偽) の **4パターン** すべてが必要。
    - **注意点:** 条件が1つ増えるごとにテストケースが**倍々（指数関数的）に増える**ため、複雑なプログラムではコストが膨大になる。

### 2. メリットとデメリット

|特徴|内容|
|---|---|
|**メリット**|ソースコードの記述ミスや、滅多に通らない特殊なルートにあるバグを確実に発見できる。|
|**デメリット**|コードが仕様通りに書かれているかを確認する性質上、「そもそも必要な機能が実装されていない（仕様の漏れ）」には気づきにくい。|